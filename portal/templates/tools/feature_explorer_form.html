{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="container py-4">

  <div class="row justify-content-center">
    <div class="col-12 col-xl-10">
  
      <div class="card shadow-sm">
        <div class="card-body p-4">

          <div class="d-flex justify-content-between align-items-center mb-2">
            <h3 class="mb-0">Feature Explorer</h3>
          </div>
          <p class="text-muted mb-3">Select a source and submit. Weâ€™ll compute RNA-FM embeddings and show a t-SNE plot.</p>

          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <!-- Input source -->
            <div class="mb-3">
              <label class="form-label">Input source</label>
              {{ form.input_mode }}
              {% if form.input_mode.errors %}<div class="invalid-feedback d-block">{{ form.input_mode.errors }}</div>{% endif %}
            </div>

            <!-- Paste sequences -->
            <div id="pasteBox" class="mb-3" style="display:none;">
              <label class="form-label">Paste sequences</label>
              {{ form.sequences_text }}
              {% if form.sequences_text.errors %}<div class="invalid-feedback d-block">{{ form.sequences_text.errors }}</div>{% endif %}
              <div class="form-text">Accepts raw lines or FASTA.</div>
            </div>

            <!-- File upload -->
            <div id="fileBox" class="mb-3" style="display:none;">
              <label class="form-label">Upload FASTA file</label>
              {{ form.file }}
              {% if form.file.errors %}<div class="invalid-feedback d-block">{{ form.file.errors }}</div>{% endif %}
            </div>

            <div id="fileBox2" class="mb-3" style="display:none;">
              <label class="form-label">Upload CSV file</label>
              {{ form.file }}
              {% if form.file.errors %}<div class="invalid-feedback d-block">{{ form.file.errors }}</div>{% endif %}
              <div class="form-text">CSV must include a column header named <code>sequence</code>.</div>
            </div>

            <button class="btn btn-primary">Explore</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const modeEl  = document.querySelector('[name="input_mode"]');
  const pasteBox = document.getElementById('pasteBox');
  const fileBox  = document.getElementById('fileBox');
  const fileBox2  = document.getElementById('fileBox2');

  (function removeDatabaseOption(){
    if (!modeEl) return;
    const dbOpt = modeEl.querySelector('option[value="database"]');
    if (dbOpt) {
      dbOpt.disabled = true;
      dbOpt.remove();
    }
  })();

  function applyMode() {
    const v = modeEl?.value;
    pasteBox.style.display = (v === 'text') ? '' : 'none';
    fileBox.style.display  = (v === 'fasta') ? '' : 'none';
    fileBox2.style.display  = (v === 'csv') ? '' : 'none';
  }
  modeEl?.addEventListener('change', applyMode);
  applyMode();
</script>
{% endblock %}
